# See: https://github.com/fluent/helm-charts/blob/main/charts/fluent-bit/values.yaml for more configuration parameters
#
# This configuration:
# 1. Reads container logs generated by the node.
# 2. Annotates them with Kubernetes details.
# 3. Filters out logs for containers that don't carry a `log.category=app` label.
#    You can change or remove this filter to include logs from other Kubernetes objects.
# 4. Renames the standard `log` message field to CLEF's `@m`.
# 5. Attempts to parse any nested JSON from `@m`.
# 6. Emits the record as CLEF direcly to Seq.
#    You can specify a `Header X-Seq-ApiKey <Your API Key Here>` to use an API key when ingesting.

config:
  inputs: |
    [INPUT]
        Name tail
        Path /var/log/containers/*.log
        multiline.parser docker, cri
        Tag kube.*
        Mem_buf_limit 5MB
        Skip_Long_lines On
  filters: |
    [FILTER]
        Name kubernetes
        Match kube.*
        Merge_log On
        Keep_log Off
        K8S-Logging.Parser On
        K8S-Logging.Exclude On

    [FILTER]
        Name grep
        Match kube.*
        Regex $kubernetes['labels']['log.category'] app

    [FILTER]
        Name modify
        Match kube.*
        Rename log @m

    [FILTER]
        Name parser
        Match kube.*
        Key_name @m
        Reserve_data True
        Parser json
  outputs: |
    [OUTPUT]
        Name http
        Match kube.*
        Host seq-dev.default.svc.cluster.local
        Port 5341
        URI /api/events/raw?clef
        Format json_lines
        Json_date_key @t
        Json_date_format iso8601
        Log_response_payload False
